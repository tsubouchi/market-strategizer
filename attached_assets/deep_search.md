層検索システム 仕様書

1. 概要
	•	システム名称
キーワード別深層検索システム (Deep Keyword Search System)
	•	目的・背景
	•	特定の複数キーワードに対して、それぞれ従来の検索エンジンでは拾いきれないページや情報を包括的に収集し、整理・分析する。
	•	一般的な検索エンジンの上位ページだけでなく、検索結果の下位ページや他の情報源（ニュースサイト、ブログ、SNS、論文データベースなど）も対象にする“深層検索”機能を提供。
	•	分析結果をレポート化し、ユーザーが目的に合わせてキーワード情報を深掘りできる環境を整える。
	•	想定ユーザー
	•	リサーチャー、マーケター、ジャーナリスト、学術研究者など、広範囲かつ詳細な情報が必要なユーザー。
	•	特定のトピックを包括的・俯瞰的に調べたい個人・組織。

2. 全体アーキテクチャ
┌──────────────┐
│   フロントエンド(UI)   │
│ (React/Next.jsなど)     │
└──────────────┘
          │
          │ (REST/GraphQL API)
          ▼
┌───────────────────┐
│    アプリケーションサーバー    │
│  (Node.js/Python/Go など)      │
│   - 検索制御ロジック            │
│   - キーワード別検索管理       │
│   - 深層スクレイピング          │
│   - 検索結果データ統合         │
└───────────────────┘
          │
          │ (DB接続)
          ▼
┌───────────────────┐
│     データベース           │
│ (PostgreSQL / MySQL /      │
│       NoSQL など)          │
│   - ユーザー情報            │
│   - キーワード管理          │
│   - 検索結果キャッシュ       │
│   - 分析用構造化データ       │
└───────────────────┘
          │
          │ (APIコール / クローラ)
          ▼
┌──────────────────────────┐
│   外部サービス・検索エンジンAPI  │
│    (Google/Bing/NewsAPI等)       │
│   各種ウェブサイト(スクレイピング) │
└──────────────────────────┘

3. 機能要件

3.1. キーワード管理機能
	1.	キーワード登録
	•	ユーザーが任意のキーワードを入力し、検索用に登録できる。
	•	例: 「AI トレンド」「データサイエンス 就職」など。
	•	複数キーワードの一括登録やインポート(CSVなど)にも対応。
	2.	キーワード編集・削除
	•	登録済みキーワードのラベル名変更や削除が可能。
	•	カテゴリ分け機能(例: 技術系/ビジネス系 など)があると検索管理がしやすい。
	3.	キーワードグループ機能 (オプション)
	•	複数の関連キーワードを一つのグループとして扱い、グループ単位で深層検索を実行できる。

3.2. 検索機能
	1.	表層検索 (通常の検索エンジン活用)
	•	Google/Bingなどの検索エンジンAPIを利用し、上位〜下位の結果をできる限り取得。
	•	API利用には、各検索エンジンの利用規約に準拠したキーの管理が必要。
	•	取得するページ数やランク範囲を設定可能(例: 1〜50位、1〜100位など)。
	2.	深層スクレイピング
	•	通常の検索エンジンから得られる上位ページ以外にも、検索結果の下位や関連リンクをたどって情報を取得。
	•	ニュースサイトや特定メディア、論文データベース、SNSなどの範囲をカスタマイズ。
	•	負荷や法的制限を考慮し、適切なスクレイピング制御(リクエスト間隔、ロボット排除規定の遵守)を行う。
	3.	検索結果の解析・加工
	•	取得したHTMLをテキスト抽出し、不要なタグやスクリプトを除去。
	•	検索キーワードとの関連度スコアの算出（キーワード頻度、キーワード出現位置など）。
	•	類義語・関連語を自動抽出して再検索する機能（オプション）。
	4.	AI連携（要約・分類） (オプション)
	•	OpenAIや他のNLP APIを用いて、スクレイピングしたテキストの要約・トピック分類を行う。
	•	キーワード単位または記事単位で要約を保存し、ユーザーが後から要点を素早く把握できる。

3.3. 結果表示・レポート機能
	1.	検索結果一覧表示
	•	取得したURL一覧や記事タイトル、要約、関連度スコアをUIで確認可能。
	•	ソート/フィルタリング機能（日時順、スコア順、サイトドメイン別など）。
	2.	キーワード別ダッシュボード
	•	キーワードごとに、取得した記事数、ドメイン分布、主な要点などを可視化(グラフ・チャート表示)。
	•	「最新ニュース」「人気サイト」「よく出現する関連ワード」などのまとめ。
	3.	レポート出力
	•	PDFやCSV形式で検索結果の要約・統計をエクスポート。
	•	定期レポート(週次・月次)の自動生成・メール送信（オプション）。

3.4. スケジューラ・ジョブ管理機能 (オプション)
	1.	自動クロールスケジュール設定
	•	毎日深夜にキーワードごとに深層検索を走らせる、などの定期実行。
	•	失敗時の再試行や、メール・Slack通知。
	2.	過去データの保管期間管理
	•	一定期間を過ぎた検索結果・スクレイピングデータを自動削除またはアーカイブ。

3.5. ユーザー管理・権限
	1.	ユーザー登録/認証
	•	メールアドレス+パスワード、OAuth(Google, GitHub)など。
	2.	権限レベル
	•	管理者(システム設定変更可能)

4. 非機能要件
	1.	パフォーマンス
	•	同時に複数のキーワード検索が走ってもタイムアウトしない設計。
	•	大規模スクレイピングになる場合は、ジョブキューや分散アーキテクチャを導入検討。
	2.	セキュリティ
	•	HTTPS必須、APIキーなどの秘密情報は環境変数管理。
	•	スクレイピング対象サイトのrobots.txtや利用規約を遵守。
	3.	可用性・耐障害性
	•	クラウドサービス(AWS, GCP, Azure等)でホスティングし、定期的にバックアップを取得。
	4.	メンテナンス性
	•	Dockerなどを使用し、環境の再現性を確保。
	•	コードのモジュール化、ユニットテスト・統合テストを整備。
	5.	拡張性
	•	新たな検索エンジンAPIやSNSプラットフォームに接続できるようプラグイン構造を検討。	
	•	一般ユーザー(キーワード管理、検索機能利用のみ)	

5. データベース設計（例）	
-- ユーザーテーブル
CREATE TABLE IF NOT EXISTS users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  role VARCHAR(50) DEFAULT 'user', -- 'admin', 'user' など
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- キーワード管理テーブル
CREATE TABLE IF NOT EXISTS keywords (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id),
  keyword VARCHAR(255) NOT NULL,
  category VARCHAR(255), 
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 検索結果テーブル
CREATE TABLE IF NOT EXISTS search_results (
  id SERIAL PRIMARY KEY,
  keyword_id INT REFERENCES keywords(id),
  title TEXT,
  url TEXT,
  snippet TEXT,          -- 検索結果の抜粋
  relevance_score FLOAT, -- キーワードとの関連度
  summary TEXT,          -- AI要約など（オプション）
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 検索ジョブ管理（スケジュール実行用） (オプション)
CREATE TABLE IF NOT EXISTS search_jobs (
  id SERIAL PRIMARY KEY,
  keyword_id INT REFERENCES keywords(id),
  status VARCHAR(50),        -- 'pending', 'running', 'completed', 'error'
  scheduled_at TIMESTAMP,    -- 実行予定時刻
  finished_at TIMESTAMP,
  log TEXT,                  -- 実行結果ログ
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

6. ユーザーストーリー
	1.	新規ユーザーがキーワードを登録し、深層検索を実行
	•	AI トレンド と VR ゲーム を登録。深層検索ボタンを押す。
	•	システムが検索エンジンAPI＋スクレイピングを実行し、上位〜下位ページ・関連サイトを調査。
	•	ダッシュボードに記事一覧と要約が表示される。
	2.	ユーザーが検索結果を絞り込んでレポートを作成
	•	不要な記事は除外し、関連度スコアの高いものだけをピックアップ。
	•	PDFレポートを出力して上司やクライアントに提出。
	3.	管理者がスケジュールを設定し、毎日自動でキーワードを巡回
	•	失敗した場合に再試行する。
	•	朝に自動でメール通知が届き、新着トピックをすぐに確認できる。